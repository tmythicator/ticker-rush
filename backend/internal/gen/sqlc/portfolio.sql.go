// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: portfolio.sql

package sqlc

import (
	"context"
)

const addPortfolioItem = `-- name: AddPortfolioItem :exec
INSERT INTO portfolio_items (user_id, stock_symbol, quantity, average_price)
VALUES ($1, $2, $3, $4)
ON CONFLICT (user_id, stock_symbol) DO UPDATE SET
    quantity = portfolio_items.quantity + EXCLUDED.quantity,
    average_price = (portfolio_items.average_price * portfolio_items.quantity + EXCLUDED.average_price * EXCLUDED.quantity) / (portfolio_items.quantity + EXCLUDED.quantity)
`

type AddPortfolioItemParams struct {
	UserID       int64
	StockSymbol  string
	Quantity     int32
	AveragePrice float64
}

func (q *Queries) AddPortfolioItem(ctx context.Context, arg AddPortfolioItemParams) error {
	_, err := q.db.Exec(ctx, addPortfolioItem,
		arg.UserID,
		arg.StockSymbol,
		arg.Quantity,
		arg.AveragePrice,
	)
	return err
}

const getPortfolio = `-- name: GetPortfolio :many
SELECT user_id, stock_symbol, quantity, average_price
FROM portfolio_items
WHERE user_id = $1
`

func (q *Queries) GetPortfolio(ctx context.Context, userID int64) ([]PortfolioItem, error) {
	rows, err := q.db.Query(ctx, getPortfolio, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PortfolioItem
	for rows.Next() {
		var i PortfolioItem
		if err := rows.Scan(
			&i.UserID,
			&i.StockSymbol,
			&i.Quantity,
			&i.AveragePrice,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const removePortfolioItem = `-- name: RemovePortfolioItem :exec
DELETE FROM portfolio_items
WHERE user_id = $1 AND stock_symbol = $2
`

type RemovePortfolioItemParams struct {
	UserID      int64
	StockSymbol string
}

func (q *Queries) RemovePortfolioItem(ctx context.Context, arg RemovePortfolioItemParams) error {
	_, err := q.db.Exec(ctx, removePortfolioItem, arg.UserID, arg.StockSymbol)
	return err
}

const setPortfolioItem = `-- name: SetPortfolioItem :exec
INSERT INTO portfolio_items (user_id, stock_symbol, quantity, average_price)
VALUES ($1, $2, $3, $4)
ON CONFLICT (user_id, stock_symbol) DO UPDATE SET
    quantity = EXCLUDED.quantity,
    average_price = EXCLUDED.average_price
`

type SetPortfolioItemParams struct {
	UserID       int64
	StockSymbol  string
	Quantity     int32
	AveragePrice float64
}

func (q *Queries) SetPortfolioItem(ctx context.Context, arg SetPortfolioItemParams) error {
	_, err := q.db.Exec(ctx, setPortfolioItem,
		arg.UserID,
		arg.StockSymbol,
		arg.Quantity,
		arg.AveragePrice,
	)
	return err
}
